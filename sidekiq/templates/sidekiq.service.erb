# Based on https://github.com/mperham/sidekiq/blob/master/examples/systemd/sidekiq.service

[Unit]
Description=sidekiq
After=syslog.target network.target

[Service]
# As of v6.0.6, Sidekiq automatically supports systemd's `Type=notify` and watchdog service
# monitoring. If you are using an earlier version of Sidekiq, change this to `Type=simple`
# and remove the `WatchdogSec` line.
Type=notify
WatchdogSec=10

WorkingDirectory=<%= app_path %>
ExecStart=<%= bundle_path %> exec sidekiq -e <%= node['deploy']['rails_env'] %>

User=<%= deploy_user %>
Group=<%= deploy_group %>
UMask=0002

Environment=MALLOC_ARENA_MAX=2

RestartSec=1
Restart=on-failure

StandardOutput=file:<%= app_path %>/log/sidekiq.log

[Install]
WantedBy=multi-user.target
